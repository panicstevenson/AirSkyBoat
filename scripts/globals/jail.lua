xi.jail = xi.jail or {}

xi.jail.jailCells =
{
    -- Floor 1 (Bottom)
    {-620, 11,  660, 0, 131},
    {-180, 11,  660, 0, 131},
    {260, 11,  660, 0, 131},
    {700, 11,  660, 0, 131},
    {-620, 11,  220, 0, 131},
    {-180, 11,  220, 0, 131},
    {260, 11,  220, 0, 131},
    {700, 11,  220, 0, 131},
    {-620, 11, -220, 0, 131},
    {-180, 11, -220, 0, 131},
    {260, 11, -220, 0, 131},
    {700, 11, -220, 0, 131},
    {-620, 11, -620, 0, 131},
    {-180, 11, -620, 0, 131},
    {260, 11, -620, 0, 131},
    {700, 11, -620, 0, 131},
    -- Floor 2 (Top)
    {-620, -400,  660, 0, 131},
    {-180, -400,  660, 0, 131},
    {260, -400,  660, 0, 131},
    {700, -400,  660, 0, 131},
    {-620, -400,  220, 0, 131},
    {-180, -400,  220, 0, 131},
    {260, -400,  220, 0, 131},
    {700, -400,  220, 0, 131},
    {-620, -400, -220, 0, 131},
    {-180, -400, -220, 0, 131},
    {260, -400, -220, 0, 131},
    {700, -400, -220, 0, 131},
    {-620, -400, -620, 0, 131},
    {-180, -400, -620, 0, 131},
    {260, -400, -620, 0, 131},
    {700, -400, -620, 0, 131},
}

xi.jail.cellBorders =
{
    -- Floor 1 (Bottom)
    {x1 = -609.8442, y1 = 12.0000,   z1 =  649.5000, x2 = -629.9188, y2 = 12.0000,  z2 =  680.5000},
    {x1 = -169.5658, y1 = 12.0000,   z1 =  649.5000, x2 = -190.1123, y2 = 12.0000,  z2 =  680.5000},
    {x1 =  270.4114, y1 = 12.0000,   z1 =  649.5000, x2 =  249.9970, y2 = 12.0000,  z2 =  680.5000},
    {x1 =  710.2119, y1 = 12.0000,   z1 =  649.5000, x2 =  690.0690, y2 = 12.0000,  z2 =  680.5000},
    {x1 = -609.8547, y1 = 12.0000,   z1 =  209.7000, x2 = -630.1546, y2 = 12.0000,  z2 =  240.5000},
    {x1 = -169.9204, y1 = 12.0000,   z1 =  209.7000, x2 = -190.2708, y2 = 12.0000,  z2 =  240.5000},
    {x1 =  270.1076, y1 = 12.0000,   z1 =  209.7000, x2 =  249.8888, y2 = 12.0000,  z2 =  240.5000},
    {x1 =  710.2205, y1 = 12.0000,   z1 =  209.7000, x2 =  689.6954, y2 = 12.0000,  z2 =  240.5000},
    {x1 = -609.7886, y1 = 12.0000,   z1 = -230.2000, x2 = -630.2947, y2 = 12.0000,  z2 = -199.3000},
    {x1 = -169.8283, y1 = 12.0000,   z1 = -230.2000, x2 = -190.2377, y2 = 12.0000,  z2 = -199.3000},
    {x1 =  270.0926, y1 = 12.0000,   z1 = -230.2000, x2 =  249.5883, y2 = 12.0000,  z2 = -199.3000},
    {x1 =  710.2014, y1 = 12.0000,   z1 = -230.2000, x2 =  689.6616, y2 = 12.0000,  z2 = -199.3000},
    {x1 = -609.8428, y1 = 12.0000,   z1 = -630.3000, x2 = -629.8869, y2 = 12.0000,  z2 = -599.4000},
    {x1 = -169.6852, y1 = 12.0000,   z1 = -630.3000, x2 = -190.2803, y2 = 12.0000,  z2 = -599.4000},
    {x1 =  270.0214, y1 = 12.0000,   z1 = -630.3000, x2 =  249.2175, y2 = 12.0000,  z2 = -599.4000},
    {x1 =  710.1602, y1 = 12.0000,   z1 = -630.3000, x2 =  689.6882, y2 = 12.0000,  z2 = -599.4000},
    -- Floor 2 (Top)
    {x1 = -609.8442, y1 = -400.0000, z1 = 649.5000, x2 = -629.9188, y2 = -400.0000, z2 =  680.5000},
    {x1 = -169.5658, y1 = -400.0000, z1 = 649.5000, x2 = -190.1123, y2 = -400.0000, z2 =  680.5000},
    {x1 =  270.4114, y1 = -400.0000, z1 = 649.5000, x2 =  249.9970, y2 = -400.0000, z2 =  680.5000},
    {x1 =  710.2119, y1 = -400.0000, z1 = 649.5000, x2 =  690.0690, y2 = -400.0000, z2 =  680.5000},
    {x1 = -609.8547, y1 = -400.0000, z1 = 209.7000, x2 = -630.1546, y2 = -400.0000, z2 =  240.5000},
    {x1 = -169.9204, y1 = -400.0000, z1 = 209.7000, x2 = -190.2708, y2 = -400.0000, z2 =  240.5000},
    {x1 =  270.1076, y1 = -400.0000, z1 = 209.7000, x2 =  249.8888, y2 = -400.0000, z2 =  240.5000},
    {x1 =  710.2205, y1 = -400.0000, z1 = 209.7000, x2 =  689.6954, y2 = -400.0000, z2 =  240.5000},
    {x1 = -609.7886, y1 = -400.0000, z1 = 230.2000, x2 = -630.2947, y2 = -400.0000, z2 = -199.3000},
    {x1 = -169.8283, y1 = -400.0000, z1 = 230.2000, x2 = -190.2377, y2 = -400.0000, z2 = -199.3000},
    {x1 =  270.0926, y1 = -400.0000, z1 = 230.2000, x2 =  249.5883, y2 = -400.0000, z2 = -199.3000},
    {x1 =  710.2014, y1 = -400.0000, z1 = 230.2000, x2 =  689.6616, y2 = -400.0000, z2 = -199.3000},
    {x1 = -609.8428, y1 = -400.0000, z1 = 630.3000, x2 = -629.8869, y2 = -400.0000, z2 = -599.4000},
    {x1 = -169.6852, y1 = -400.0000, z1 = 630.3000, x2 = -190.2803, y2 = -400.0000, z2 = -599.4000},
    {x1 =  270.0214, y1 = -400.0000, z1 = 630.3000, x2 =  249.2175, y2 = -400.0000, z2 = -599.4000},
    {x1 =  710.1602, y1 = -400.0000, z1 = 630.3000, x2 =  689.6882, y2 = -400.0000, z2 = -599.4000},
}

xi.jail.goToCell = function(player, cellId)
    local cellID = tonumber(cellId)
    player:setPos(xi.jail.jailCells[cellID][1], xi.jail.jailCells[cellID][2], xi.jail.jailCells[cellID][3], xi.jail.jailCells[cellID][4], xi.jail.jailCells[cellID][5])
end

xi.jail.registerRegions = function(zone)
    for cellId, spawn in pairs(xi.jail.cellBorders) do
        if spawn and cellId then
            zone:registerRegion(cellId, spawn.x1, spawn.y1, spawn.z1, spawn.x2, spawn.y2, spawn.z2)
        end
    end
end

xi.jail.restrainCell = function(player)
    player:warp()
    player:setCharVar('[JAIL]punish', player:getCharVar('[JAIL]punish') + 1)
end

xi.jail.punish = function(player)
    player:addStatusEffectEx(xi.effect.TERROR, xi.effect.NONE, 1, 3, player:getCharVar('[JAIL]punish') * 60)
    player:setAnimation(7) -- Force player to sit.
    player:injectActionPacket(5, 282, 0, 0, 0, 0)
end

xi.jail.pardon = function(target)
    target:setCharVar( '[JAIL]inJail', 0 )
    target:setCharVar( '[JAIL]cellSet', 0 )
    target:warp()
end

xi.jail.sendToJail = function(player, target)
    local cellId = GetZone(131):getLocalVar("[JAIL]Cell_Taken") + 1
    GetZone(131):setLocalVar("[JAIL]Cell_Taken", cellId)

    if cellId > 32 then
        cellId = 1
        GetZone(131):setLocalVar("[JAIL]Cell_Taken", 1)
    end

    local dest = xi.jail.jailCells[ cellId ]
    target:setCharVar( "[JAIL]inJail", cellId )
    target:setPos(dest[1], dest[2], dest[3], dest[4], 131)

    return cellId
end
